# 本地 MCP 开发需求完整指南

在现有项目中使用 Spec Workflow MCP 开发新需求的详细步骤

## 🤖 关于 MCP 工具调用

**重要说明**：使用 Spec Workflow MCP 有两种方式：

### 方式一：自然语言（推荐） 🎯
- 直接用中文描述你的需求
- Claude 会自动选择合适的 MCP 工具
- 无需记住工具名称和参数

### 方式二：了解底层工具 🔧
- 了解系统提供的 27 个 MCP 工具
- 可以指定具体工具调用
- 适合高级用户和调试场景

> **推荐使用方式一**，本指南主要展示自然语言交互，同时会标注对应的底层工具供参考。

## 准备工作

### 1. 安装 Spec Workflow MCP

```bash
# 在你的项目根目录执行
npm install -g @pimzino/spec-workflow-mcp
```

### 2. 配置 Claude Desktop

编辑 Claude Desktop 配置文件：

**macOS**: `~/Library/Application Support/Claude/claude_desktop_config.json`
**Windows**: `%APPDATA%\Claude\claude_desktop_config.json`

```json
{
  "mcpServers": {
    "spec-workflow": {
      "command": "spec-workflow-mcp",
      "args": ["--port", "3000", "--lang", "zh"]
    }
  }
}
```

### 3. 重启 Claude Desktop

配置完成后重启 Claude Desktop，确保 MCP 服务器正确加载。

---

## 第一步：项目初始化

### 1.1 在现有项目中初始化 Spec Workflow

**方式一：自然语言（推荐）**
在 Claude 中发送：
```
请帮我在当前项目中初始化 Spec Workflow 系统
```

**方式二：直接调用 MCP 工具**
Claude 会自动调用：`init_project`
- 参数：根据当前目录自动设置

这会创建 `.spec-workflow/` 目录和基本配置文件。

> 💡 **说明**：你不需要记住具体的 MCP 工具名称，直接用自然语言描述需求即可，Claude 会自动选择合适的工具。

### 1.2 验证初始化成功

检查项目根目录是否出现：
```
.spec-workflow/
├── session.json
├── config.toml
└── steering/
```

---

## 第二步：启动仪表板

### 2.1 启动实时仪表板

**自然语言方式：**
```
启动仪表板，端口 3000
```

**底层工具：** `open_dashboard`
- 参数：`port: 3000`

### 2.2 访问仪表板

浏览器自动打开 `http://localhost:3000`，你将看到：
- 项目概览
- 规范列表
- 任务进度
- 实时更新状态

---

## 第三步：创建技术指导文档

### 3.1 分析现有项目技术栈

在 Claude 中发送：

```
请分析当前项目的技术栈，然后创建技术指导文档
```

### 3.2 创建指导文档示例

```
创建技术架构指导文档，内容包括：
- 当前使用的技术栈：[你的技术栈]
- 编码规范和最佳实践
- 数据库设计原则
- API 设计规范
- 测试策略
```

---

## 第四步：创建需求规范

### 4.1 创建新需求规范

假设你要开发一个用户通知功能：

```
创建 "用户通知系统" 规范文档，包含以下内容：

## 需求描述
- 实时推送通知
- 邮件通知
- 站内消息
- 通知偏好设置

## 技术要求
- 支持多种通知渠道
- 消息队列处理
- 用户偏好管理
- 通知历史记录

## 接口设计
- POST /api/notifications - 发送通知
- GET /api/notifications - 获取通知列表
- PUT /api/user/notification-preferences - 更新偏好设置

## 数据模型
- notifications 表
- user_notification_preferences 表
- notification_templates 表
```

### 4.2 在仪表板中查看

规范创建后，在仪表板中可以看到：
- 新增的规范文档
- 自动提取的任务列表
- 进度追踪

---

## 第五步：任务分解与管理

### 5.1 自动提取开发任务

```
从 "用户通知系统" 规范中提取开发任务
```

系统会自动识别并创建任务，如：
- 1.1 设计数据库表结构
- 1.2 实现通知发送接口
- 1.3 开发前端通知组件
- 2.1 集成邮件服务
- 2.2 实现推送通知

### 5.2 查看任务进度

```
获取 "用户通知系统" 规范的任务完成进度
```

---

## 第六步：并行开发分析（Phase 4）

### 6.1 分析并行机会

```
分析 "用户通知系统" 规范的并行执行机会，使用平衡模式
```

系统会分析哪些任务可以并行开发：
- 前端和后端可以并行
- 不同通知渠道可以并行
- 数据库设计和接口设计有依赖关系

### 6.2 启动并行开发

```
并行执行 "用户通知系统" 规范的任务，最多同时运行 2 个任务
```

这会创建多个 Git worktree，每个任务在独立的工作区中开发。

---

## 第七步：代码质量保证

### 7.1 运行代码分析

在开发过程中定期运行：

```
运行代码分析代理，检查当前项目的代码质量
```

### 7.2 分析输出示例

代理会报告：
- 🔴 发现 2 个严重安全漏洞
- 🟡 发现 5 个潜在性能问题
- 🟢 验证 8 个组件安全性良好
- 📊 代码质量评级：B+

### 7.3 优化项目上下文

```
优化当前项目的上下文，压缩比例 80%
```

这会压缩冗余信息，提高后续分析效率。

---

## 第八步：进度跟踪与更新

### 8.1 更新任务状态

当完成某个任务时：

```
将规范 "用户通知系统" 中的任务 "1.2" 状态更新为 "completed"
```

### 8.2 实时查看进度

仪表板会实时显示：
- ✅ 已完成：3/8 任务 (37.5%)
- 🔄 进行中：2 个任务
- ⏳ 待开始：3 个任务

---

## 第九步：协作与审批（企业环境）

### 9.1 请求代码审核

```
为 "用户通知系统" 规范请求批准，批准者：tech-lead@company.com
```

### 9.2 查看待审批项目

技术负责人可以：

```
显示所有待批准的规范列表
```

### 9.3 批准规范

```
批准 ID 为 "notification-system-001" 的规范，状态设为 "approved"
```

---

## 第十步：生成报告与归档

### 10.1 生成开发报告

```
生成项目进度报告，格式为 markdown
```

报告包含：
- 📈 整体进度统计
- ⏱️ 开发时间分析
- 🎯 里程碑完成情况
- 🔍 代码质量评估

### 10.2 归档完成的规范

功能开发完成后：

```
归档已完成的 "用户通知系统" 规范，备注：v1.0 正式发布
```

---

## 实际使用示例

### 完整开发流程示例

假设你要在一个 React + Node.js 项目中开发"用户头像上传"功能：

#### 1. 初始化和启动
```
请帮我在当前项目中初始化 Spec Workflow 系统
启动仪表板，端口 3000
```

#### 2. 创建规范
```
创建 "用户头像上传" 规范文档，包含：
- 支持多格式图片上传 (JPEG, PNG, WebP)
- 图片尺寸限制和压缩
- 头像预览和裁剪
- 后端存储和CDN集成
- 前端 React 组件开发
```

#### 3. 任务管理
```
从 "用户头像上传" 规范中提取开发任务
分析 "用户头像上传" 规范的并行执行机会
```

#### 4. 并行开发
```
并行执行 "用户头像上传" 规范的任务，最多同时运行 2 个任务
```

#### 5. 质量保证
```
运行代码分析代理，检查新增的头像上传代码
```

#### 6. 进度更新
```
将任务 "前端头像组件" 状态更新为 "completed"
将任务 "后端上传接口" 状态更新为 "completed"
```

#### 7. 完成归档
```
获取 "用户头像上传" 规范的任务完成进度
归档已完成的 "用户头像上传" 规范
```

---

## 目录结构变化

开发过程中，你的项目结构会变成：

```
your-project/
├── src/                          # 你的源代码
├── .spec-workflow/               # Spec Workflow 数据
│   ├── steering/                 # 技术指导文档
│   │   └── architecture.md
│   ├── specs/                    # 规范文档
│   │   ├── user-notification-system/
│   │   │   ├── requirements.md
│   │   │   ├── design.md
│   │   │   └── tasks.md
│   │   └── user-avatar-upload/
│   │       ├── requirements.md
│   │       └── tasks.md
│   ├── approval/                 # 审批记录
│   ├── archive/                  # 归档规范
│   ├── worktrees/               # 并行开发工作区
│   │   ├── task-frontend-123/
│   │   └── task-backend-456/
│   ├── session.json             # 会话信息
│   └── config.toml              # 配置文件
├── package.json
└── ...
```

---

## 常见工作流程

### 1. 快速功能开发
```bash
# 1. 创建规范
"创建 'XX功能' 规范文档"

# 2. 提取任务
"从 'XX功能' 规范中提取开发任务"

# 3. 开始开发
"并行执行 'XX功能' 规范的任务"

# 4. 更新进度
"将任务 '1.1' 状态更新为 'completed'"
```

### 2. 复杂功能开发
```bash
# 1. 分析现有代码
"运行代码分析代理，评估现有代码"

# 2. 创建详细规范
"创建详细的 'XX系统' 规范文档"

# 3. 分析并行机会
"分析 'XX系统' 规范的并行执行机会，使用保守模式"

# 4. 分阶段执行
"并行执行第一阶段任务"
"并行执行第二阶段任务"
```

### 3. 团队协作开发
```bash
# 1. 请求审批
"为 'XX功能' 规范请求批准"

# 2. 生成报告
"生成项目进度报告"

# 3. 优化上下文
"优化项目上下文，提高团队协作效率"
```

---

## 注意事项

### ✅ 最佳实践

1. **及时更新任务状态** - 保持进度同步
2. **定期运行代码分析** - 确保代码质量
3. **合理使用并行开发** - 避免冲突
4. **保持规范文档更新** - 记录需求变更

### ⚠️ 注意事项

1. **Git 状态检查** - 并行开发前确保 Git 状态干净
2. **端口冲突** - 确保 3000 端口可用
3. **权限问题** - 确保目录写入权限
4. **网络访问** - 某些功能需要网络连接

### 🔧 故障排除

如果遇到问题：

```bash
# 检查 MCP 连接
"获取当前项目的完整上下文"

# 重启仪表板
"启动仪表板，端口 3001"

# 检查配置
"显示当前 Spec Workflow 配置"
```

---

## 🔍 MCP 工具快速参考

如果你想了解底层调用的具体工具，以下是常用工具列表：

### 基础工具 (Phase 1)
- `init_project` - 项目初始化
- `create_spec` - 创建规范文档
- `open_dashboard` - 启动仪表板
- `list_specs` - 列出所有规范
- `get_project_context` - 获取项目上下文

### 任务管理 (Phase 2)
- `extract_tasks` - 提取任务
- `update_task_status` - 更新任务状态
- `get_task_progress` - 获取任务进度

### 企业功能 (Phase 3)
- `request_approval` - 请求批准
- `generate_progress_report` - 生成报告
- `set_language` - 设置语言

### 并行执行 (Phase 4)
- `analyze-parallel` - 分析并行机会
- `execute-parallel` - 执行并行任务
- `run-agent` - 运行智能代理
- `pm:context-optimize` - 上下文优化

### 🎯 使用建议

1. **新手用户**：完全使用自然语言，无需记住工具名称
2. **进阶用户**：了解工具名称可以更精确地控制行为
3. **调试场景**：直接指定工具名称可以快速定位问题

## 总结

通过以上步骤，你可以在现有项目中完整地使用 Spec Workflow MCP 来开发新需求。系统提供了从需求分析到代码质量保证的完整工作流程，特别是 Phase 4 的并行开发功能可以显著提升开发效率。

**关键要点**：
- ✅ **无需记住命令** - 直接用自然语言描述需求
- ✅ **Claude 自动选择** - 系统会调用合适的 MCP 工具
- ✅ **27个工具支持** - 覆盖完整开发生命周期
- ✅ **实时仪表板** - 可视化监控开发进度

记住在 Claude 中使用自然语言与 MCP 工具交互，系统会自动处理底层的技术细节。